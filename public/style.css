document.addEventListener('DOMContentLoaded', () => {
    const socket = io({
        auth: { token: localStorage.getItem('token') }
    });

    const darkModeButton = document.getElementById('toggle-dark-mode');
    const loginContainer = document.getElementById('login-container');
    const chatContainer = document.getElementById('chat-container');
    const messageForm = document.getElementById('message-form');
    const messagesDiv = document.getElementById('messages');

    // Mode sombre
    darkModeButton.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('dark-mode', document.body.classList.contains('dark-mode'));
    });

    // Charger la préférence de mode sombre
    if (localStorage.getItem('dark-mode') === 'true') {
        document.body.classList.add('dark-mode');
    }

    // Gestion des formulaires d'inscription et de connexion
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        // Code d'inscription
    });

    document.getElementById('signin-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        // Code de connexion
    });

    // Envoi de message
    messageForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const messageInput = document.getElementById('message-input');
        const message = messageInput.value;
        if (message.trim() !== "") {
            socket.emit('send_message', message);
            messageInput.value = '';
        }
    });

    // Afficher les messages et autres événements
    socket.on('receive_message', (data) => {
        const messageElem = document.createElement('div');
        messageElem.classList.add('message', data.sender === socket.username ? 'sender' : 'receiver');
        messageElem.textContent = `${data.sender}: ${data.message}`;
        messagesDiv.appendChild(messageElem);
    });

    socket.on('typing', (username) => {
        // Code d'indicateur de saisie
    });
});
